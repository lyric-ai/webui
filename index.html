<body>
  <h2>生成图像</h2>
  <input id="jellyfish" placeholder="请输入提示词" style="width:300px;" />
  <button id="generateBtn">生成</button>
  <p id="status"></p>
  <img id="resultImage" style="max-width: 100%; margin-top: 20px;" />

  <script>
    const generateBtn = document.getElementById('generateBtn');
    const statusText = document.getElementById('status');
    const resultImage = document.getElementById('resultImage');
    const jellyfishInput = document.getElementById('jellyfish');

    generateBtn.addEventListener('click', async () => {
      const jellyfish = jellyfishInput.value.trim();
      if (!jellyfish) {
        statusText.innerText = "提示词不能为空";
        return;
      }

      statusText.innerText = "正在提交任务...";

      const res = await fetch("/api/generate.js", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ jellyfish })
      });

      const data = await res.json();
      const generateUuid = data.generateUuid;

      if (!generateUuid) {
        statusText.innerText = "提交失败";
        return;
      }

      statusText.innerText = "已提交，等待生成...";

      const checkStatus = async () => {
        const res = await fetch("/api/generate/status.js", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ generateUuid })
        });

        const result = await res.json();
        if (result.status === "success") {
          resultImage.src = result.previewImageUrl;
          statusText.innerText = "生成成功";
        } else if (result.status === "fail") {
          statusText.innerText = "生成失败";
        } else {
          statusText.innerText = "生成中...";
          setTimeout(checkStatus, 2000);
        }
      };

      checkStatus();
    });
  </script>
</body>
